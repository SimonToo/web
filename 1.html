<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“æ–‡ä»¶ç´¢å¼•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; color: #333; }
        h1 { border-bottom: 2px solid #eaeaea; padding-bottom: 0.5rem; }
        
        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
        .nav-bar { background: #f6f8fa; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-family: monospace; font-size: 1.1em; display: flex; align-items: center; }
        .nav-bar button { margin-right: 10px; cursor: pointer; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: white; }
        .nav-bar button:hover { background: #eee; }
        .current-path { color: #0366d6; font-weight: bold; }

        #loading { color: #666; font-style: italic; }
        #file-list { list-style: none; padding: 0; border: 1px solid #e1e4e8; border-radius: 6px; }
        #file-list li { border-bottom: 1px solid #e1e4e8; padding: 10px 15px; display: flex; align-items: center; transition: background 0.1s; }
        #file-list li:last-child { border-bottom: none; }
        #file-list li:hover { background-color: #f6f8fa; }
        
        .icon { margin-right: 12px; width: 20px; text-align: center; }
        
        /* æ–‡ä»¶å¤¹æ ·å¼ */
        .item-folder { cursor: pointer; color: #24292e; font-weight: 600; flex-grow: 1; }
        .item-folder:hover { color: #0366d6; }
        
        /* æ–‡ä»¶é“¾æ¥æ ·å¼ */
        .item-file { text-decoration: none; color: #0366d6; flex-grow: 1; }
        .item-file:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <h1>ğŸ“š æ–‡ä»¶åˆ—è¡¨: SimonToo/web</h1>

    <div class="nav-bar" id="nav-bar" style="display:none;">
        <button onclick="goBack()" id="btn-back">â¬… è¿”å›ä¸Šä¸€çº§</button>
        <span>å½“å‰è·¯å¾„ï¼š/ <span id="path-display" class="current-path"></span></span>
    </div>

    <div id="loading">æ­£åœ¨åŠ è½½ä»“åº“ç»“æ„...</div>
    <ul id="file-list"></ul>

    <script>
        // --- é…ç½®åŒºåŸŸ ---
        const config = {
            owner: 'SimonToo',
            repo: 'web',
            baseUrl: 'https://web.tuchong.tk/' 
        };

        // å…¨å±€å˜é‡å­˜å‚¨æ‰€æœ‰æ–‡ä»¶æ•°æ®å’Œå½“å‰è·¯å¾„
        let allFiles = []; 
        let currentPath = ""; // ç©ºå­—ç¬¦ä¸²ä»£è¡¨æ ¹ç›®å½•

        const listElement = document.getElementById('file-list');
        const loadingElement = document.getElementById('loading');
        const navBar = document.getElementById('nav-bar');
        const pathDisplay = document.getElementById('path-display');
        const btnBack = document.getElementById('btn-back');

        // 1. åˆå§‹åŒ–ï¼šè·å–æ•°æ®
        async function init() {
            try {
                // è·å–é»˜è®¤åˆ†æ”¯
                const repoInfoRes = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}`);
                if (!repoInfoRes.ok) throw new Error("æ— æ³•è·å–ä»“åº“ä¿¡æ¯");
                const repoInfo = await repoInfoRes.json();
                const defaultBranch = repoInfo.default_branch;

                // é€’å½’è·å–æ‰€æœ‰æ–‡ä»¶
                const treeUrl = `https://api.github.com/repos/${config.owner}/${config.repo}/git/trees/${defaultBranch}?recursive=1`;
                const treeRes = await fetch(treeUrl);
                const treeData = await treeRes.json();

                // è¿‡æ»¤å‡ºæ–‡ä»¶(blob)ï¼Œæˆ‘ä»¬é€šè¿‡è·¯å¾„å­—ç¬¦ä¸²æ¥æ¨å¯¼æ–‡ä»¶å¤¹
                allFiles = treeData.tree.filter(item => item.type === 'blob');

                loadingElement.style.display = 'none';
                navBar.style.display = 'flex';
                
                // é¦–æ¬¡æ¸²æŸ“æ ¹ç›®å½•
                renderList(""); 

            } catch (error) {
                console.error(error);
                loadingElement.innerText = "âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API é™åˆ¶ã€‚";
                loadingElement.style.color = "red";
            }
        }

        // 2. æ ¸å¿ƒæ¸²æŸ“é€»è¾‘
        function renderList(path) {
            currentPath = path;
            listElement.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨
            
            // æ›´æ–°å¯¼èˆªæ çŠ¶æ€
            pathDisplay.innerText = path;
            btnBack.style.display = path === "" ? "none" : "block"; // æ ¹ç›®å½•éšè—è¿”å›æŒ‰é’®

            // ä¸´æ—¶å­˜å‚¨å½“å‰å±‚çº§çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶
            const folders = new Set();
            const files = [];

            // éå†æ‰€æœ‰æ–‡ä»¶ï¼Œç­›é€‰å‡ºå±äºå½“å‰ path çš„ä¸‹ä¸€çº§å†…å®¹
            allFiles.forEach(file => {
                // å¦‚æœå½“å‰å¤„äºæ ¹ç›®å½• (pathä¸ºç©º)ï¼Œæˆ–è€…æ–‡ä»¶è·¯å¾„ä»¥ currentPath + '/' å¼€å¤´
                if (path === "" || file.path.startsWith(path + "/")) {
                    
                    // è·å–æ–‡ä»¶ç›¸å¯¹äºå½“å‰ path çš„å‰©ä½™è·¯å¾„
                    // ä¾‹å¦‚ï¼špath="b", file="b/c/d.html" -> relative="c/d.html"
                    // ä¾‹å¦‚ï¼špath="", file="a.html" -> relative="a.html"
                    let relative = path === "" ? file.path : file.path.substring(path.length + 1);
                    
                    // åˆ†å‰²è·¯å¾„
                    const parts = relative.split('/');

                    if (parts.length > 1) {
                        // å¦‚æœå‰©ä½™è·¯å¾„è¿˜æœ‰æ–œæ ï¼Œè¯´æ˜å®ƒæ˜¯å­æ–‡ä»¶å¤¹
                        folders.add(parts[0]);
                    } else {
                        // å¦åˆ™å®ƒæ˜¯å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶
                        files.push({
                            name: parts[0],
                            fullPath: file.path
                        });
                    }
                }
            });

            // å…ˆæ¸²æŸ“æ–‡ä»¶å¤¹
            Array.from(folders).sort().forEach(folderName => {
                const li = document.createElement('li');
                // ç‚¹å‡»æ–‡ä»¶å¤¹ï¼šè¿›å…¥ä¸‹ä¸€çº§ (å½“å‰è·¯å¾„ + æ–‡ä»¶å¤¹å)
                const nextPath = path === "" ? folderName : path + "/" + folderName;
                
                li.innerHTML = `
                    <span class="icon">ğŸ“‚</span>
                    <span class="item-folder" onclick="renderList('${nextPath}')">${folderName}</span>
                `;
                listElement.appendChild(li);
            });

            // å†æ¸²æŸ“æ–‡ä»¶
            files.sort((a, b) => a.name.localeCompare(b.name)).forEach(file => {
                const li = document.createElement('li');
                // æ‹¼æ¥æœ€ç»ˆè·³è½¬é“¾æ¥
                const finalUrl = config.baseUrl + file.fullPath;
                
                li.innerHTML = `
                    <span class="icon">ğŸ“„</span>
                    <a href="${finalUrl}" class="item-file" target="_blank">${file.name}</a>
                `;
                listElement.appendChild(li);
            });

            // å¦‚æœè¯¥ç›®å½•ä¸‹ä¸ºç©º
            if (folders.size === 0 && files.length === 0) {
                listElement.innerHTML = '<li style="color:#999; justify-content:center;">(æ­¤æ–‡ä»¶å¤¹ä¸ºç©º)</li>';
            }
        }

        // 3. è¿”å›ä¸Šä¸€çº§
        function goBack() {
            if (currentPath === "") return;
            // ç§»é™¤è·¯å¾„ä¸­æœ€åä¸€éƒ¨åˆ†
            const lastSlashIndex = currentPath.lastIndexOf('/');
            if (lastSlashIndex === -1) {
                renderList(""); // å›åˆ°æ ¹ç›®å½•
            } else {
                renderList(currentPath.substring(0, lastSlashIndex));
            }
        }

        // å¯åŠ¨
        init();
    </script>

</body>
</html>